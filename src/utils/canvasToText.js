import { createWorker } from "tesseract.js";

const base64Image =
  "data:image/png;base64,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";

const extractTimeDateAndDay = (text) => {
  const regex =
    /(?<day>\b[A-Z][a-z]{2})(?<date>\d{1,2})(?<month>[A-Z][a-z]{2})(?<year>\d{2})\s+(?<time>\d{2}:\d{2})/;
  const { date, month, year, day, time } = text.match(regex).groups;
  return { date: `${date}-${month}-${year}`, day: day, time: time };
};

export async function extractText() {
  const worker = await createWorker();
  await worker.reinitialize("eng");

  const {
    data: { text },
  } = await worker.recognize(base64Image);

  await worker.terminate();

  return extractTimeDateAndDay(text);
}
